<!doctype html>
<!--[if IE 7]>  <html class="no-js lt-ie10 lt-ie9 lt-ie8 ie7" lang="en"> <![endif]-->
<!--[if IE 8]>  <html class="no-js lt-ie10 lt-ie9 ie8" lang="en"> <![endif]-->
<!--[if IE 9]>  <html class="no-js lt-ie10 ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es"> <!--<![endif]-->
<head>
    <script></script>
    <meta charset="utf-8" />
    <title>Extensions</title>

    <!-- Mobile viewport optimization http://goo.gl/b9SaQ -->
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="cleartype" content="on">
    <link rel="stylesheet" href="http://static.mlstatic.com/org-img/ch/ui/0.13.4/chico.min.css">
    <link rel="stylesheet" href="/search-box-ui/chico.css">
</head>

<body>
    <div class="ml-header">
        <h1 id="components" class="ch-shownby-pointertap" aria-owns="ch-layer-34" aria-haspopup="true">Extensions (Chico UI 1.1.1)</h1>
    </div>

    <section id="autocomplete">
        <h1>Autocomplete Search Box</h1>

            <form class="nav-search" action="/" method="GET" role="search">
                <input type="text" class="nav-search-input" name="as_word" value="" max-length="120"/>

                <p id="mlCategory" class="nav-category" title="Solo en reporductores">
                    <input type="checkbox" id="categorySearch" name="as_categ_id" value="MLA7262"/>
                    <label for="categorySearch" onclick>Solo en reproductores</label>
                </p>

                <button type="submit" name="mlSearchBtn" class="nav-search-btn">
                    <i class="nav-icon-search"></i>
                    <span class="ch-hide">Buscar</span>
                </button>
            </form>

    </section>

    <script type="text/javascript" src="http://static.mlstatic.com/org-img/ch/vendor/jquery/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="http://static.mlstatic.com/org-img/ch/ui/0.13.4/chico.js"></script>


    <!-- Search box standalone -->
    <script type="text/javascript" src="/search-box-ui/chico.js"></script>

    <script type="text/javascript">
        /**
         * Autocomplete searchbox
         * Description: instance and configuration of the autocomplete component with offical store suggestions.
         */
        // Configuration of the autocomplete component with chico 1.1.1 standalone
        var autocompleteConfig = {
            'searchForm': $('.nav-search'),
            'categoryCheckbox': $('#categorySearch'),
            'categoryCheckboxLabel': $('label[for="categorySearch"]'),
            'maxQueryLength': 35,
            'meliDomain': '${siteInfoHelper.getDomainUrl(searchContext.siteId)}',
            'searchQuery': "${siteInfoHelper.getNaturalSearchUrlWithQueryParameter(searchContext.layout,searchContext.baseUrl,null,searchContext.overridenLayout,'replace')?.replace('replace','$query')}",
            'searchQueryInCategory' : "${siteInfoHelper.getUriCateg(searchResultFe, searchContext, '$query')}",
            'currentCategory': "${searchResultFe?.getSelectedCategoryId()}",
            'suggestionsQuantity': 20,
            'siteId': "${searchContext.siteId}",
            'platformId': '${searchContext.platform}',
            'officialStoreFiltersEnabled': "${onOffHelper.check([id:"autosuggestWithStores",siteId:searchContext.siteId,visualId:searchContext.visualId],params)}",
            'messages':{
                'lastSearches': '<%=t9n.tr(s:"Últimas búsquedas")%>',
                'inOfficialStore': '<%=t9n.tr(s:"en tienda oficial")%> ',
                'inAllOficialStores': '<%=t9n.tr(s:"en todas las ")%>',
                'officalStoreName': '<%=t9n.tr(s:"tiendas oficiales")%>'
            },
            'isMobile':'false',
            'position':'fixed'
        };

        // Instance of autocomplete with chico 1.1.1 standalone
        autocomplete = new ac.Autocomplete($('.nav-search-input'), autocompleteConfig);


        // Position fixed when the autocomplete is ready
        autocomplete.on('ready', function (e) {
            // Fix temporal to issue #1217 and #1227 in Chico
            this._popover.$container.css({
                'position': this._options.position,
                'width': (this._$el[0].getBoundingClientRect().width)? this._$el[0].getBoundingClientRect().width : this._$el[0].offsetWidth
            });
        });


        // Instance of autocomplete scroll when the popover is showed
        autocomplete._popover.once('show', function () {
            $('.ac-popover-content').perfectScrollbar({
                suppressScrollX: true
            });
        });


        // Check if the input searchbox value is different to the search query url params
        if (autocomplete._el.value !== "${searchContext.query}") {
            autocomplete._el.blur();
            autocomplete._el.focus();
            autocomplete.emit("type","");
        }
    </script>

</body>
</html>
